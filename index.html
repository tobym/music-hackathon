<!DOCTYPE html>
<html>


<head>
<meta charset="utf-8">
<link rel="stylesheet" href="style.css" type="text/css" media="screen">
<link rel="stylesheet" href="sp://import/css/adam.css">
<script src="libs/js/jquery.min.js"></script>
<<<<<<< HEAD
<script src="libs/js/mustache.js"></script>

=======
<script src="libs/js/functions.js"></script>
>>>>>>> updated images.
<script type="text/javascript">

  var Game = {
    // User-visible message
    update_message: function(msg) {
      $("#message").html(msg);
      this.log(msg);
    },
    // Debug log
    log: function(msg) {
      $("#debug_log").append("<p>" + msg + "</p>");
    },
    api_host : "http://backend:4567",
    username : "",
    turn_id : "",
    // Auto re-syncs game state if it is messed up for some reason.
    post : function(path, data, success) {
      data.turn_id = Game.turn_id;
      data.username = Game.username;
      $.ajax({
        type: 'POST',
        url: this.api_host + path,
        data: data,
        success: success,
        statusCode: {
          400: function(data) {
            var err = "Got 400: " + data.message;
            console.log(err);

            console.log("Got 400: " + data.message);
            if ("resync" == data.action) {
              this.update_message("Game out of sync...resyncing");
              refreshGamestate();
            };
          }
        },
        dataType: "json"
      });
      
    }
  };

  function displayGamestate(state) {
    $dashboard = $("#game_dashboard");

    tmpl = $("#gamestate_tmpl").html();
    $dashboard.html(Mustache.render(tmpl, state));
  };

  function refreshGamestate() {
    $.get(Game.api_host + "/gamestate", function(data) {
      Game.turn_id = data.turn_id;
      displayGamestate(data);
    });
  };

  $(document).ready(function() {
    /* Instantiate the global sp object; include models & views */
    var sp = getSpotifyApi(1);
    var models = sp.require('sp://import/scripts/api/models');
    var views = sp.require('sp://import/scripts/api/views');

    /*
     * Register username and join the (current global) game.
     */
    $("#register_btn").on("click", function() {
      var username = $("#username").val();
      console.log("Registering " + username);
      $.post(Game.api_host + "/register", {"username" : username}, function(data) {
        console.log("Register username response: " + data);

        Game.update_message(data.message);
        Game.username = data.username;
        Game.turn_id = data.turn_id;

        // Transition to game state.
        $.get(Game.api_host + "/gamestate", function(data) {
          $("#register").hide();
          $("#current_question").html(data.question.question);
          $("#round").html("Round " + data.round);
          // $("#current_question_keywords").html(data.question.keywords);
          $("#submission").show();
          displayGamestate(data);
        });
      });
    });

    /*
     * Cast your vote.
     */
    $("#submit_btn").on("click", function() {
      var songname = $("#submission_input").val();
      $.post(Game.api_host + "/submit_song", {"username" : Game.username, "turn_id" : Game.turn_id, "songname" : songname}, function(data) {
        console.log(data);
      });
    });

    $("#debug").on("click", function() {
      refreshGamestate();
    });

  });

</script>
</head>

<body>

  <li><a href="sp://music-hackathon/rules.html"> Read the Rules</a></li>

  <button id="debug">Refresh gamestate</button>

  <header>Songville with Friends</header>

  <div id="round">
    1
  </div>

  <div id="message">
    Welcome
  </div>

  <!-- REGISTER -->
  <div id="register">
    <input type="text" id="username" placeholder="Name"/>
    <button id="register_btn">Register</button>
  </div>

  <div id="submission" style="display:none">
    <div id="current_question"></div>
    <div id="current_question_keywords"></div>

    <div>
      <input type="text" id="submission_input" placeholder="Song title..."/>
      <button id="submit_btn">Submit song</button>
    </div>
  </div>

  <div id="game_dashboard">
    <h2>this is the game dashboard</h2>
  </div>



<br/>







<!-- Main begins here -->
  <div id="main">
  	<div id="your_song">
  	hi
  	
  	</div>
  	
  	<div id="song_list">
		<ul>
			<li class="song_album"></li>
			<li class="song_album"></li>
			<li class="song_album"></li>
			<li class="song_album"></li>
			<li class="song_album"></li>
		</ul>
  	</div>
  	
  	<div id="player_list">
		<ul>
			<li class="avatar"></li>
			<li class="avatar"></li>
			<li class="avatar"></li>						
			<li class="avatar"></li>
			<li class="avatar"></li>			
		</ul>
  	</div>
   
   
   
   
			<div class="win_text">
<p> Congratulations, you won the round. You have destroyed your opponents, this time. </p>
</div>

<div class="head">
<img src="images/tandy.jpg"/>
</div>


<div class="ninja">
<!-- <img src="images/ninja.jpg"/> -->

</div>

        	


  </div> <!-- end of main -->

<script>

<script>

function win_and_slide() {
		$(document).ready(function() {	
			//animate ninja and player's head
			$('.head, .ninja').show();

			$('.head, .ninja').animate({
		    	left: '+=200px',
			}, 2000, function() {
		    // Animation complete.
	
			});
			//animate winning text
			$('.win_text').show()
	
			$('.win_text').animate({
	    		right: '+=200px',
			}, 2000, function() {
		    // Animation complete.
	
			});
		});
	}

//win_and_slide();
               	               	
</script>
               	               	
</script>







  <script>

    var sp = getSpotifyApi(1);
    var models = sp.require('sp://import/scripts/api/models');

    var search = new models.Search("Bohemian Rhapsody");

    search.observe(models.EVENT.CHANGE, function() {

      search.tracks.forEach(function(track) {
        console.log(track);
      });
    });

    search.appendNext();
  </script>        	


  <script id="gamestate_tmpl" type="text/html">
    <h2>Game state</h2>
    <h3>Question</h3>
    <p>{{question.question}}</p>
    <h3>Question Keywords</h3>
    <ul>
      {{#question.keywords}}
      <li>{{question.keywords}}</li>
      {{/question.keywords}}
    </ul>
    <h3>Round</h3>
    <p>Round {{round}}</p>
    <h3>Players</h3>
    <ul>
      {{#players}}
      <li>{{username}}</li>
      {{/players}}
    </ul>
    <h3>Submissions</h3>
    <ul>
      {{#submissions}}
      <li>{{songname}} :: submitted by {{submitter}}</li>
      {{/submissions}}
    </ul>
  </script>
  
</body>
</html>
